# ========= Data (CSV) =========
data_manager:
  # === TRAINING ===
  csv_path: "data/raw_data/mushroom_raw_data.csv"

  # === INFERENCE ===
  prod_database_path: "data/prod_data/database_prod.csv"              # auto-created
  real_time_data_prod_path: "data/prod_data/real_time_data_prod.csv"  # your streaming feed (UI source)
  predictions_path: "data/prod_data/predictions.csv"                  # auto-created/appended

# ========= Pipeline Runner =========
pipeline_runner:
  # === TRAINING ===
  model_path: "models/final_gbr.pkl"

  # === INFERENCE ===
  batch_size: 24                          # last N rows to build features (>= 7 for roll3/6; 168 is safe)
  first_timestamp: "2024-08-23 06:00:00"    # must exist in real_time_data_prod.csv
  time_increment: "1h"                      # lowercase to avoid pandas warning
  num_inference_steps: 1                 # matches stream length for batch script


# ========= Inference output formatting =========
inference:
  output_integer: true
  integer_strategy: "round"   # "round" | "floor" | "ceil"
  min_value: 0                # clamp negative predictions to 0+

# ========= Preprocessing =========
preprocessing:
  drop_columns:
    - veil-type #only one category
    - stalk-root #many missing values

# ========= Feature Engineering =========
feature_engineering:
  rolling_windows: [3, 6]
  weather_deltas: [temp_c, feelslike_c, precip_mm]

# ========= Training =========
training:
  target:
    source_col: poisonous
    horizon: 1
    target_name: target
  train_fraction: 0.8
  gbr_params:
    n_estimators: 400
    learning_rate: 0.08
    max_depth: 3
    min_samples_leaf: 3
    subsample: 0.8
    max_features: "sqrt"
    random_state: 42
  grid_search:
    enabled: true
    param_grid:
      n_estimators: [200, 400]
      learning_rate: [0.05, 0.08, 0.1]
      max_depth: [2, 3]
      min_samples_leaf: [3, 5]
      subsample: [0.8, 1.0]
      max_features: ["sqrt", null]
  xgb_limitdepth:
    n_estimators: 7
    max_depth: 4
    min_child_weight: 10.453257529365422
    learning_rate: 0.6983303292403192
    subsample: 0.9713995429415797
    colsample_bylevel: 0.917891643644131
    colsample_bytree: 1.0
    reg_alpha: 0.23784536078242194
    reg_lambda: 9.79256619575218

# ========= Reports =========
reports:
  metrics_path: "reports/train_metrics.json"
